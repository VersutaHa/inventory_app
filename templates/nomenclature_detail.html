<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ nomen.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 15px; background: #f5f5f5; }
        h2 { color: #2c3e50; }
        .form-box { background: white; padding: 15px; border-radius: 8px; margin: 15px 0; }
        input, button, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background: #2ecc71; color: white; border: none; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #34495e; color: white; }
        summary { cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h2>üì¶ {{ nomen.name }} ({{ nomen.code }})</h2>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ nomen.category or '-' }}</p>
    <p><strong>–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫:</strong> <span style="font-size:1.4em;color:#27ae60;">{{ total }}</span> –µ–¥.</p>

    <a href="{{ url_for('index') }}">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

    <div class="form-box">
        <details>
            <summary>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—Ö–æ–¥ (–Ω–æ–≤—É—é –ø–∞—Ä—Ç–∏—é)</summary>
            <form method="POST" action="{{ url_for('add_receipt', nomen_id=nomen.id) }}" style="margin-top:10px;">
                <input type="text" name="batch_number" placeholder="‚Ññ –ø–∞—Ä—Ç–∏–∏ *" required>
                <input type="number" name="manufacture_year" placeholder="–ì–æ–¥ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è *" min="1900" max="2100" required>
                <input type="text" name="manufacturer" placeholder="–ó–∞–≤–æ–¥-–∏–∑–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å *" required>
                <input type="number" name="quantity" placeholder="–ö–æ–ª-–≤–æ *" min="1" required>
                <input type="text" name="location" placeholder="–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è">
                <hr>
                <input type="text" name="doc_number" placeholder="‚Ññ –¥–æ–∫—É–º–µ–Ω—Ç–∞ *" required>
                <select name="doc_type" required>
                    <option value="">‚Äî –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî</option>
                    {% for dt in doc_types %}
                    <option value="{{ dt }}">{{ dt|capitalize }}</option>
                    {% endfor %}
                </select>
                <input type="date" name="doc_date" value="{{ today }}" required>
                <input type="text" name="issued_by" placeholder="–ö–µ–º –≤—ã–¥–∞–Ω">
                <input type="text" name="notes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ">
                <button type="submit">+ –ü—Ä–∏—Ö–æ–¥</button>
            </form>
        </details>
    </div>

    <h3>üì¶ –ü–∞—Ä—Ç–∏–∏ ({{ batches|length }})</h3>
    {% if batches %}
        <table>
            <thead>
                <tr>
                    <th>‚Ññ –ø–∞—Ä—Ç–∏–∏</th>
                    <th>–ì–æ–¥</th>
                    <th>–ó–∞–≤–æ–¥</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for b in batches %}
                <tr>
                    <td>{{ b.batch_number }}</td>
                    <td>{{ b.manufacture_year }}</td>
                    <td>{{ b.manufacturer }}</td>
                    <td><strong>{{ b.quantity }}</strong></td>
                    <td>{{ b.location or '-' }}</td>
                    <td>
                        <details>
                            <summary style="color:#e74c3c;">‚Äì –°–ø–∏—Å–∞—Ç—å</summary>
                            <form method="POST" action="{{ url_for('write_off', batch_id=b.id) }}" style="margin-top:5px;">
                                <input type="hidden" name="nomen_id" value="{{ nomen.id }}">
                                <input type="number" name="quantity" placeholder="–ö–æ–ª-–≤–æ" min="1" max="{{ b.quantity }}" required style="width:80px;">
                                <input type="text" name="doc_number" placeholder="‚Ññ –¥–æ–∫—É–º–µ–Ω—Ç–∞" required style="width:100px;">
                                <select name="doc_type" required style="width:120px;font-size:12px;">
                                    {% for dt in doc_types %}
                                    <option value="{{ dt }}">{{ dt|capitalize }}</option>
                                    {% endfor %}
                                </select>
                                <input type="date" name="doc_date" value="{{ today }}" required style="width:120px;">
                                <button type="submit" style="padding:3px 6px;font-size:12px;background:#e74c3c;">–°–ø–∏—Å–∞—Ç—å</button>
                            </form>
                        </details>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>üì≠ –ù–µ—Ç –ø–∞—Ä—Ç–∏–π.</p>
    {% endif %}
</body>
</html>